//视图
v_menu

create or replace view v_menu as
select sm.*,SC.SC_NAME from sys_menu sm
LEFT JOIN SYS_CONFIGURE SC ON SC.ID = SM.SC_ID

v_button

create or replace view v_button as
SELECT SB.ID,SB.SB_NAME,SB.SB_BUTTONID,SB.SB_ICON,SB.SB_CODE,SB.SB_ORDER,SB.SB_TYPE,SDI.SDI_NAME SB_TYPE_NAME
FROM sys_button SB
LEFT JOIN sys_dict_info SDI ON SDI.SDT_CODE = 'SYS_BUTTON_TYPE' AND SDI.SDI_CODE = SB.SB_TYPE

v_role

create or replace view v_role as
SELECT SR.ID,SR.SR_TYPE,SR.SR_CODE,SR.SR_NAME,SR.SR_EXPLAIN,SR.SR_REMARK,SR.IS_STATUS FROM sys_role SR

v_configure_column

create or replace view v_configure_column as
SELECT
SCC.ID,SCC.SC_ID,SCC.SCC_NAME,SCC.SCC_FIELD,SCC.SCC_ALIGN,SCC.SCC_WIDTH,SCC.SCC_SDT_CODE,SCC.SCC_IS_OPERATION,SCC.SCC_IS_VISIBLE,SCC.SCC_IS_STATUS,SCC.SCC_ORDER,SCC.SCC_IS_FIXED,SCC.SCC_IS_EXPORT
FROM sys_configure_column SCC

v_configure_search

create or replace view v_configure_search as
SELECT
SCS.ID,SCS.SC_ID,SCS.SCS_NAME,SCS.SCS_FIELD,SCS.SCS_SDT_CODE,SCS.SCS_METHOD_TYPE,SCS.SCS_TYPE,SCS.SCC_IS_VISIBLE,SCS.SCS_ORDER,SCS.SCS_REMARK
FROM sys_configure_search SCS

v_configure_file

create or replace view V_CONFIGURE_FILE as
SELECT
SCF.*,SC.SC_NAME
FROM SYS_CONFIGURE_FILE SCF
INNER JOIN SYS_CONFIGURE SC ON SC.ID = SCF.SC_ID

v_validate

create or replace view v_validate as
select sv.* from sys_validate sv


v_validate_field

CREATE OR REPLACE VIEW V_VALIDATE_FIELD AS
SELECT SVF.*,SVR.SVR_NAME,SVG.SVG_GROUPS FROM SYS_VALIDATE_FIELD SVF
LEFT JOIN SYS_VALIDATE_REGEX SVR ON SVR.ID = SVF.SVR_ID
LEFT JOIN (SELECT SVGF.SVF_ID,GROUP_CONCAT(SVG.SVG_GROUP ORDER BY CONVERT (SVG.ID, SIGNED) ASC) AS SVG_GROUPS FROM SYS_VALIDATE_GROUP SVG INNER JOIN SYS_VALIDATE_GROUP_FIELD SVGF ON SVGF.SVG_ID = SVG.ID GROUP BY SVG.SV_ID,SVGF.SVF_ID ORDER BY CONVERT(SVG.ID,SIGNED) ASC)SVG ON SVF.ID = SVG.SVF_ID

v_validate_regex

create or replace view v_validate_regex as
select svr.* from sys_validate_regex svr

v_validate_group

CREATE OR REPLACE VIEW V_VALIDATE_GROUP AS
SELECT SVG.*,SVGF.SVF_NAMES FROM SYS_VALIDATE_GROUP SVG
LEFT JOIN (SELECT SVGF.SVG_ID,GROUP_CONCAT(SVF.SVF_NAME) AS SVF_NAMES FROM SYS_VALIDATE_GROUP_FIELD SVGF INNER JOIN SYS_VALIDATE_FIELD SVF ON SVF.ID = SVGF.SVF_ID GROUP BY SVGF.SVG_ID)SVGF ON SVGF.SVG_ID = SVG.ID

v_dict_type

create or replace view v_dict_type as
select sdt.* from sys_dict_type sdt

v_dict_info

create or replace view v_dict_info as
select sdi.* from sys_dict_info sdi

v_operator

CREATE OR REPLACE VIEW V_OPERATOR AS
SELECT SO.ID,SO.IS_STATUS,SAI.SAI_NAME,SAI.SAI_PHONE,SAI.SAI_EMAIL,SOS.SOS_USERNAME,SAI.SAI_TYPE,TDI.SDI_NAME AS SAI_TYPE_NAME
FROM SYS_OPERATOR SO
INNER JOIN SYS_ACCOUNT_INFO SAI ON SAI.SO_ID = SO.ID
LEFT JOIN (SELECT SOS.SO_ID,GROUP_CONCAT(DISTINCT SOS.SOS_USERNAME) AS SOS_USERNAME FROM SYS_OPERATOR_SUB SOS GROUP BY SOS.SO_ID)SOS ON SOS.SO_ID = SO.ID
LEFT JOIN SYS_DICT_INFO TDI ON TDI.SDT_CODE ='SYS_ROLE_TYPE' AND TDI.SDI_CODE = SAI.SAI_TYPE

v_operator_sub

CREATE OR REPLACE VIEW V_OPERATOR_SUB AS
SELECT SOS.* FROM SYS_OPERATOR_SUB SOS

v_format

CREATE OR REPLACE VIEW V_FORMAT AS
SELECT SF.* FROM SYS_FORMAT SF


v_format_detail

CREATE OR REPLACE VIEW V_FORMAT_DETAIL AS
SELECT SFD.*,SM.SM_NAME FROM SYS_FORMAT_DETAIL SFD
LEFT JOIN SYS_MENU SM ON SM.ID = SFD.SM_ID


v_process_definition

CREATE OR REPLACE VIEW V_PROCESS_DEFINITION AS
SELECT
    SPD.*,
    (CASE WHEN SPD.IS_TIME_CONTROL = 1 THEN CONCAT(SPTC.SPTC_START_TIME,'  -  ',SPTC.SPTC_END_TIME) ELSE '' END) AS SPTC_TIME
FROM SYS_PROCESS_DEFINITION SPD
LEFT JOIN SYS_PROCESS_TIME_CONTROL SPTC ON SPTC.SPD_ID = SPD.ID AND SPTC.IS_STATUS = 1

v_process_step

CREATE OR REPLACE VIEW V_PROCESS_STEP AS
SELECT SPS.*,SR.SR_NAME
FROM SYS_PROCESS_STEP SPS
LEFT JOIN SYS_ROLE SR ON SR.ID = SPS.SR_ID

v_process_time_control

CREATE OR REPLACE VIEW V_PROCESS_TIME_CONTROL AS
SELECT SPTC.*
FROM SYS_PROCESS_TIME_CONTROL SPTC



v_process_schedule

CREATE OR REPLACE VIEW V_PROCESS_SCHEDULE AS
SELECT SPS.*,SPD.SPD_NAME,SAI.SAI_NAME AS INITIATOR_NAME,SAIC.SAI_NAME CANCEL_NAME,SPSC.ID AS SPSC_ID,SPSC.SPSC_REASON,SPSC.SPSC_ENTRY_TIME,SDI.SDI_NAME AS PROCESS_STATUS_NAME,SPT.SPS_NAME AS STEP_NAME
FROM SYS_PROCESS_SCHEDULE SPS
LEFT JOIN SYS_PROCESS_STEP SPT ON SPT.ID = SPS.SPS_ID
LEFT JOIN SYS_PROCESS_DEFINITION SPD ON SPD.ID = SPS.SPD_ID
LEFT JOIN SYS_PROCESS_SCHEDULE_CANCEL SPSC ON SPSC.SPS_ID = SPS.ID
LEFT JOIN SYS_ACCOUNT_INFO SAI ON SAI.SO_ID = SPS.SO_ID
LEFT JOIN SYS_ACCOUNT_INFO SAIC ON SAIC.SO_ID = SPSC.SO_ID
LEFT JOIN SYS_DICT_INFO SDI ON SDI.SDT_CODE = 'SYS_PROCESS_STATUS' AND SDI.SDI_CODE = SPS.SPS_AUDIT_STATUS


v_log_see

CREATE OR REPLACE VIEW V_LOG_SEE AS
SELECT SL.ID,SL.SO_ID,SL.SL_NAME,SL.SL_EVENT,SL.SL_IP,SL.SL_RESULT,SL.SL_ENTERTIME,SL.SL_ENTERTIME AS SL_ENDTIME,
       SLT.SLT_CONTENT,SAI.SAI_NAME
FROM SYS_LOG SL
LEFT JOIN SYS_LOG_TEXT SLT ON SLT.SL_ID = SL.ID
LEFT JOIN SYS_ACCOUNT_INFO SAI ON SAI.SO_ID = SL.SO_ID
WHERE SL.SL_TYPE = 0

v_log_system

CREATE OR REPLACE VIEW V_LOG_SYSTEM AS
SELECT SL.ID,SL.SO_ID,SL.SL_NAME,SL.SL_EVENT,SL.SL_IP,SL.SL_RESULT,SL.SL_ENTERTIME,SL.SL_ENTERTIME AS SL_ENDTIME,
       SLT.SLT_CONTENT,SAI.SAI_NAME
FROM SYS_LOG SL
LEFT JOIN SYS_LOG_TEXT SLT ON SLT.SL_ID = SL.ID
LEFT JOIN SYS_ACCOUNT_INFO SAI ON SAI.SO_ID = SL.SO_ID
WHERE SL.SL_TYPE = 1

v_log_use

CREATE OR REPLACE VIEW V_LOG_USE AS
SELECT SL.ID,SL.SO_ID,SL.SL_NAME,SL.SL_EVENT,SL.SL_IP,SL.SL_RESULT,SL.SL_ENTERTIME,SL.SL_ENTERTIME AS SL_ENDTIME,
       SLT.SLT_CONTENT,SAI.SAI_NAME
FROM SYS_LOG SL
LEFT JOIN SYS_LOG_TEXT SLT ON SLT.SL_ID = SL.ID
LEFT JOIN SYS_ACCOUNT_INFO SAI ON SAI.SO_ID = SL.SO_ID
WHERE SL.SL_TYPE = 2

v_log_personal

CREATE OR REPLACE VIEW V_LOG_PERSONAL AS
SELECT SL.ID,SL.SO_ID,SL.SL_NAME,SL.SL_EVENT,SL.SL_IP,SL.SL_RESULT,SL.SL_ENTERTIME,SL.SL_ENTERTIME AS SL_ENDTIME,
       SLT.SLT_CONTENT,SAI.SAI_NAME
FROM SYS_LOG SL
LEFT JOIN SYS_LOG_TEXT SLT ON SLT.SL_ID = SL.ID
LEFT JOIN SYS_ACCOUNT_INFO SAI ON SAI.SO_ID = SL.SO_ID
WHERE SL.SL_TYPE = 9


v_log_value_record

CREATE OR REPLACE VIEW V_LOG_VALUE_RECORD AS
SELECT
		SVRC.SVR_TABLE_ID AS ID,SVRC.SVR_TABLE_ID AS SVR_TABLE,SVRC.SVR_TABLE_NAME,SVRC.SVR_ENTRY_TIME,SVRC.SVR_ENTRY_TIME AS SVR_END_TIME,SVRC.SO_ID,SVRC.SVR_TYPE,SVRC.SVR_OLD_VALUE,SVRC.SVR_NEW_VALUE,
		SAI.SAI_NAME
FROM(
		SELECT SVR.SVR_TABLE_ID,SVR.SVR_TABLE_NAME,MAX(SVR.SVR_ENTRY_TIME) AS SVR_ENTRY_TIME
		FROM SYS_VALUE_RECORD SVR
		GROUP BY SVR.SVR_TABLE_NAME,SVR.SVR_TABLE_ID
)SVR JOIN SYS_VALUE_RECORD SVRC ON SVRC.SVR_TABLE_ID = SVR.SVR_TABLE_ID AND SVRC.SVR_TABLE_NAME = SVR.SVR_TABLE_NAME AND SVRC.SVR_ENTRY_TIME = SVR.SVR_ENTRY_TIME
LEFT JOIN SYS_ACCOUNT_INFO SAI ON SAI.SO_ID = SVRC.SO_ID

v_log_value_record_detail

CREATE OR REPLACE VIEW V_LOG_VALUE_RECORD_DETAIL AS
SELECT SVR.*,SAI.SAI_NAME
FROM SYS_VALUE_RECORD SVR
LEFT JOIN SYS_ACCOUNT_INFO SAI ON SAI.SO_ID = SVR.SO_ID



//成就墙
v_achievement
CREATE OR REPLACE VIEW V_ACHIEVEMENT AS
SELECT BA.*,SAI.SAI_NAME,SF.ID AS SF_ID
FROM BUS_ACHIEVEMENT BA
LEFT JOIN SYS_ACCOUNT_INFO SAI ON SAI.SO_ID = BA.SO_ID
LEFT JOIN SYS_FILE SF ON SF.SF_TABLE_NAME = 'BUS_ACHIEVEMENT' AND SF.SF_TABLE_ID = BA.ID AND SF.ID = (SELECT MIN(SF.ID) FROM SYS_FILE SF WHERE SF.SF_TABLE_NAME = 'BUS_ACHIEVEMENT' AND SF.SF_TABLE_ID = BA.ID GROUP BY SF.SF_TABLE_ID)


v_achievement_detail
CREATE OR REPLACE VIEW V_ACHIEVEMENT_DETAIL AS
SELECT BAD.*,BA.BA_NAME,BW.BW_USERNAME
FROM BUS_ACHIEVEMENT_DETAIL BAD
INNER JOIN BUS_ACHIEVEMENT BA ON BA.ID = BAD.BA_ID
INNER JOIN BUS_WECHAT BW ON BW.ID = BAD.BW_ID


v_wechat
CREATE OR REPLACE VIEW V_WECHAT AS
SELECT BW.*,IFNULL(BWD.CLOCKIN_COUNT,0) CLOCKIN_COUNT
FROM BUS_WECHAT BW
LEFT JOIN (SELECT BAD.BW_ID,COUNT(1) CLOCKIN_COUNT FROM BUS_ACHIEVEMENT_DETAIL BAD  INNER JOIN BUS_ACHIEVEMENT BA ON BA.ID = BAD.BA_ID AND BA.IS_STATUS = 1 WHERE BAD.ID =(SELECT MAX(EAD.ID) FROM BUS_ACHIEVEMENT_DETAIL EAD WHERE EAD.BA_ID = BAD.BA_ID AND EAD.BW_ID = BAD.BW_ID GROUP BY EAD.BA_ID,EAD.BW_ID) GROUP BY BAD.BW_ID
)BWD ON BWD.BW_ID = BW.ID

v_main_image
CREATE OR REPLACE VIEW V_MAIN_IMAGE AS
SELECT BMI.*,SAI.SAI_NAME,SF.ID AS SF_ID
FROM BUS_MAIN_IMAGE BMI
LEFT JOIN SYS_ACCOUNT_INFO SAI ON SAI.SO_ID = BMI.SO_ID
LEFT JOIN SYS_FILE SF ON SF.SF_TABLE_NAME = 'BUS_MAIN_IMAGE' AND SF.SF_TABLE_ID = BMI.ID AND SF.ID = (SELECT MAX(SF.ID) FROM SYS_FILE SF WHERE SF.SF_TABLE_ID = BMI.ID GROUP BY SF.SF_TABLE_ID)












